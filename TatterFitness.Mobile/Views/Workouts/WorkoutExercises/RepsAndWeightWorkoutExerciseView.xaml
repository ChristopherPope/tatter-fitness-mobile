<?xml version="1.0" encoding="utf-8" ?>
<views:ContentPageBase
    x:Class="TatterFitness.Mobile.Views.Workouts.WorkoutExercises.RepsAndWeightWorkoutExerciseView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:TatterFitness.Mobile.Controls"
    xmlns:fontAwesome="clr-namespace:FontAwesome"
    xmlns:views="clr-namespace:TatterFitness.Mobile.Views"
    xmlns:vm="clr-namespace:TatterFitness.Mobile.ViewModels.Workouts.WorkoutExercises"
    xmlns:weControls="clr-namespace:TatterFitness.Mobile.Controls.WorkoutExercises"
    x:DataType="vm:RepsAndWeightWorkoutExerciseViewModel"
    x:TypeArguments="vm:RepsAndWeightWorkoutExerciseViewModel"
    BackgroundColor="{AppThemeBinding Dark={StaticResource WindowBackgroundColorDarkPrimary},
                                      Light={StaticResource WindowBackgroundColorPrimary}}">

    <ContentPage.Resources>
        <ResourceDictionary Source="../../../Resources/Styles/WorkoutExercisesStyles.xaml" />
    </ContentPage.Resources>

    <Shell.TitleView>
        <weControls:ShellTitle
            ExerciseName="{Binding ExerciseName}"
            ModNames="{Binding ModNames}" />
    </Shell.TitleView>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <controls:TotalEffort
            Grid.Row="0"
            CDuration="{Binding TotalEffort.TotalCDuration}"
            CMiles="{Binding TotalEffort.TotalCMiles}"
            DWDuration="{Binding TotalEffort.TotalDWDuration}"
            DWVolume="{Binding TotalEffort.TotalDWVolume}"
            ROReps="{Binding TotalEffort.TotalROReps}"
            RWVolume="{Binding TotalEffort.TotalRWVolume}" />

        <ActivityIndicator
            Grid.Row="1"
            Grid.Column="0"
            IsRunning="{Binding IsBusy}"
            IsVisible="{Binding IsBusy}" />

        <StackLayout
            Grid.Row="1"
            Orientation="Vertical">
            <CarouselView
                x:Name="SetsList"
                EmptyView="No sets, create a new set."
                IndicatorView="indicatorView"
                ItemsSource="{Binding SetVms}"
                Position="{Binding Position}"
                PositionChangedCommand="{Binding PositionChangedCommand}"
                PositionChangedCommandParameter="{Binding Source={RelativeSource Self}, Path=Position}">
                <CarouselView.ItemTemplate>
                    <DataTemplate>
                        <Grid
                            Padding="5"
                            x:DataType="vm:RepsAndWeightSetViewModel">
                            <Frame Style="{x:StaticResource Card}">
                                <StackLayout Orientation="Vertical">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <weControls:SetNumber
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            IsCompleted="{Binding IsCompleted}"
                                            SetNum="{Binding SetNumber}"
                                            TotalSets="{Binding TotalSets}" />

                                        <Grid
                                            Grid.Row="1"
                                            Grid.Column="0"
                                            Style="{StaticResource MetricsGrid}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <weControls:MetricInput
                                                Grid.Row="0"
                                                Grid.Column="0"
                                                Hint="Weight (lbs)"
                                                MetricUpdatedCommand="{Binding Path=MetricUpdatedCommand, Source={RelativeSource AncestorType={x:Type vm:RepsAndWeightWorkoutExerciseViewModel}}}"
                                                MetricValue="{Binding Weight}"
                                                SetId="{Binding SetId}" />

                                            <Label
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                Margin="0,0,0,10"
                                                FontFamily="FAS"
                                                HorizontalTextAlignment="Center"
                                                Style="{StaticResource LabelLarge}"
                                                Text="{Static fontAwesome:FontAwesomeIcons.Times}"
                                                TextColor="{AppThemeBinding Dark={StaticResource CardTextColorDarkPrimary},
                                                                            Light={StaticResource CardTextColorPrimary}}"
                                                VerticalOptions="Center" />


                                            <weControls:MetricInput
                                                Grid.Row="0"
                                                Grid.Column="2"
                                                Hint="Reps"
                                                MetricUpdatedCommand="{Binding Path=MetricUpdatedCommand, Source={RelativeSource AncestorType={x:Type vm:RepsAndWeightWorkoutExerciseViewModel}}}"
                                                MetricValue="{Binding Reps}"
                                                SetId="{Binding SetId}" />

                                            <weControls:MetricInput
                                                Grid.Row="0"
                                                Grid.Column="3"
                                                Hint="Volume"
                                                IsEnabled="False"
                                                MetricValue="{Binding Volume}"
                                                SetId="{Binding SetId}" />
                                        </Grid>
                                    </Grid>
                                </StackLayout>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>
            <IndicatorView
                x:Name="indicatorView"
                Margin="0,0,0,240"
                HorizontalOptions="Center"
                IndicatorColor="LightGray"
                IndicatorsShape="Square"
                SelectedIndicatorColor="DarkGray" />
        </StackLayout>

        <weControls:WorkoutExerciseToolbar
            Grid.Row="2"
            AddSetCommand="{Binding AddSetCommand}"
            Calculate531Command="{Binding Calculate531Command}"
            CompleteSetCommand="{Binding CompleteSetCommand}"
            DeleteSetCommand="{Binding DeleteSetCommand}"
            EditNotesCommand="{Binding EditNotesCommand}"
            Is531ButtonVisible="{Binding DoShow531Button}"
            IsCompleteSetButtonVisible="{Binding DoShowCompleteSetButton}"
            SelectModsCommand="{Binding SelectModsCommand}"
            ViewHistoryCommand="{Binding ViewHistoryCommand}" />

    </Grid>
</views:ContentPageBase>